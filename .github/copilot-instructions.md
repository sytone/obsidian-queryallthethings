# Copilot Instructions for Query All The Things

## Project Overview

Query All The Things (QATT) is an Obsidian plugin that allows users to execute flexible SQL-based queries against their data in Obsidian and render it using Handlebars templates. This plugin integrates with Obsidian's API and DataView plugin to provide powerful data querying capabilities.

## Build Commands

- `pnpm build` - Build the plugin for production
- `pnpm build:dev` - Build the plugin for development
- `pnpm test` - Run all tests
- `pnpm lint` - Run linter and auto-fix issues
- `pnpm lint:markdown` - Lint markdown files
- `pnpm build:docs` - Build documentation
- `pnpm docs:dev` - Run documentation development server
- `pnpm docs:build` - Build VitePress documentation
- `pnpm docs:preview` - Preview built documentation

## Testing Commands

- `pnpm test` - Run all tests using Node's built-in test runner
- Tests are located in `./tests/**/*.test.ts` and `./src/**/*.test.ts`
- The project uses Node's native test runner with tsx for TypeScript support

## Code Style

### TypeScript Configuration
- Use TypeScript strict mode (`noImplicitAny`, `strictNullChecks`)
- Target ES6 with ESNext modules
- All source files should be in the `src/` directory
- Compiled output goes to `dist/`

### Formatting
- **Indentation**: 2 spaces (enforced by EditorConfig)
- **Line endings**: LF (Unix-style)
- **Charset**: UTF-8
- **Final newline**: Required
- **Trailing whitespace**: Trim (except in markdown files where it may be needed)

### Naming Conventions (XO/ESLint)
- **Interfaces**: Must use PascalCase with "I" prefix (e.g., `IQuery`, `ISettings`)
- **Files**: Use PascalCase for TypeScript files, except test files which can use lowercase (e.g., `QueryService.ts`, `query.test.ts`)
- Use consistent type definitions with `interface` (not `type`)

### Code Patterns
- Prefer explicit typing over implicit
- Use ESNext features (async/await, arrow functions, etc.)
- Follow the existing code structure and patterns in the repository

## Project Structure

```
src/
├── Data/              # Data models and schemas
├── Integrations/      # Integration with external systems (DataView, etc.)
├── Interfaces/        # TypeScript interface definitions
├── Parse/             # Parsing logic for queries and markdown
├── PostRender/        # Post-rendering processing
├── Query/             # Query execution engine
├── Render/            # Rendering logic (Handlebars templates)
├── Settings/          # Plugin settings and configuration
├── UI/                # User interface components
├── handlers/          # Event handlers
├── lib/               # Shared libraries and utilities
├── main.ts            # Plugin entry point
└── typings/           # TypeScript type definitions

docs/                  # VitePress documentation
tests/                 # Test files
.config/               # Build and tooling configuration
```

## Development Workflow

### Commit Messages
- Follow [Conventional Commits](https://www.conventionalcommits.org/) format
- Types: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`, `ci`, `build`, `perf`, `security`
- Examples:
  - `feat: add new query handler`
  - `fix: resolve template rendering issue`
  - `docs: update installation guide`

### Pull Requests
- PRs must pass all linting and tests before merge
- Use the PR template in `.github/pull_request_template.md`
- Include clear descriptions of changes and their purpose

### Release Process
- Versions are managed using `standard-version`
- Version bumps update `package.json`, `manifest.json`, and `versions.json`
- Use `pnpm release` for standard releases or `pnpm release:major/minor/patch` for specific version bumps

## Boundaries and Exclusions

### Do Not Modify
- `dist/` - Build output directory (auto-generated)
- `node_modules/` - Dependencies (managed by pnpm)
- `.github/workflows/` - CI/CD workflows (unless specifically requested)
- `versions.json` - Managed by standard-version
- `CHANGELOG.md` - Auto-generated by standard-version
- `pnpm-lock.yaml` - Managed by pnpm

### Security
- Never commit secrets, API keys, or sensitive data
- Do not modify `.env` files if they contain sensitive information
- Follow secure coding practices, especially when handling user input

## Dependencies

### Core Dependencies
- **Obsidian API** (v1.7.2) - Plugin development framework
- **DataView** (v0.5.56) - Soft dependency for enhanced data queries
- **AlaSQL** (v4.4.0) - SQL query engine
- **Handlebars** (v4.7.8) - Template rendering
- **Luxon** (v3.4.4) - Date/time handling
- **PapaParse** (v5.4.1) - CSV parsing

### Development Tools
- **TypeScript** (v5.1.3)
- **XO** (v0.54.2) - Linter (extends ESLint)
- **VitePress** (v1.2.3) - Documentation
- **Ophidian Build** (v1.2.1) - Build tooling for Obsidian plugins

## Documentation

- Documentation is built with VitePress and located in the `docs/` directory
- Run `pnpm docs:dev` to preview documentation locally
- Documentation is auto-deployed to GitHub Pages
- Use `pnpm build:docs` to inject markdown snippets from source code into documentation

## Common Tasks

### Adding a New Feature
1. Create a new branch following conventional naming (e.g., `feat/new-query-type`)
2. Implement the feature in the appropriate `src/` directory
3. Add tests in `tests/` or co-located `*.test.ts` files
4. Update documentation in `docs/` if user-facing
5. Run `pnpm lint` and `pnpm test` before committing
6. Follow conventional commit format

### Fixing a Bug
1. Create a branch (e.g., `fix/query-parsing-error`)
2. Write a test that reproduces the bug (if possible)
3. Fix the issue with minimal changes
4. Verify the fix with `pnpm test`
5. Run `pnpm lint` to ensure code style compliance

### Updating Documentation
1. Edit files in `docs/` directory
2. Run `pnpm docs:dev` to preview changes
3. Use `pnpm build:docs` to update injected snippets if needed
4. Commit with `docs:` prefix

## Integration Notes

- The plugin has a soft dependency on the DataView plugin
- Query execution uses AlaSQL, which supports extended SQL syntax
- Templates use Handlebars with custom helpers defined in `src/UI/handlebarsHelpers.yaml`
- The plugin integrates with Obsidian's markdown parser and code block rendering

## Performance Considerations

- Large queries should be optimized for performance
- Template rendering can be resource-intensive with large result sets
- Consider caching strategies for frequently executed queries

## Browser/Environment
- Runs in Obsidian's Electron environment
- Has access to Node.js APIs through Obsidian
- Limited to Obsidian's API version compatibility
